// Generated by CoffeeScript 1.7.1
var currently_setting_hash, search, setRelatedDOMVisibility, updateHash, updateLabels;

$(document).on('emoji:ready', function() {
  if (location.hash.length) {
    return search($('.speedy-filter').val(location.hash.substr(1)).val());
  } else {
    return search();
  }
});

currently_setting_hash = false;

updateHash = function(keyword) {
  currently_setting_hash = true;
  window.location.hash = keyword;
  return currently_setting_hash = false;
};

updateLabels = function(keyword) {
  $('[href^="#"]').removeClass('active');
  return $("[href=#" + keyword + "]").addClass('active');
};

search = function(keyword) {
  if (keyword == null) {
    keyword = '';
  }
  $('.keyword').text(keyword);
  updateLabels(keyword);
  if (window.speedy_keyword !== keyword) {
    window.speedy_keyword = keyword;
    if (keyword.length) {
      $('.result').hide();
      $('.result').each(function() {
        if ($(this).text().indexOf(keyword) > -1) {
          return $(this).show();
        }
      });
    } else {
      $('.result').show();
    }
  }
  return setRelatedDOMVisibility(keyword);
};

setRelatedDOMVisibility = function(keyword) {
  var foundSomething;
  foundSomething = !!$('.result:visible').length;
  $('.js-queue-all').toggle(!!keyword.length && foundSomething);
  return $('.no-result').toggle(!foundSomething);
};

$(document).on('search keyup', '.speedy-filter', function() {
  search($(this).val());
  return updateHash($(this).val());
});

$(document).on('click', '.group', function() {
  return search($('.speedy-filter').val($(this).attr('href').substr(1)).val());
});

$(document).on('click', '.speedy-remover', function() {
  $('.speedy-filter').val('');
  updatehash('');
  $('.result').show();
  return search('');
});

$(window).on('hashchange', function() {
  if (currently_setting_hash) {
    currently_setting_hash = false;
  } else {
    currently_setting_hash = false;
    console.log('just set false in else');
    search($('.speedy-filter').val(window.location.hash.substr(1)).val());
    return updateLabels(window.location.hash);
  }
});
